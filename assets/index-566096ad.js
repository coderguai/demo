import{aJ as G,aK as k,A as W,P as C,aL as N,aM as T}from"./index-81730b21.js";import{c as $}from"./shared-8dcc744f.js";function b(t,r,a,n,i,o,u){try{var l=t[o](u),s=l.value}catch(R){a(R);return}l.done?r(s):Promise.resolve(s).then(n,i)}function m(t){return function(){var r=this,a=arguments;return new Promise(function(n,i){var o=t.apply(r,a);function u(s){b(o,n,i,u,l,"next",s)}function l(s){b(o,n,i,u,l,"throw",s)}u(void 0)})}}function A(){return A=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},A.apply(this,arguments)}var B="background-image",M="lazy-loading",S="lazy-error",O="lazy-attempt",D=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],y="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",c=[],d=[],w=$(100),e={loading:y,error:y,attempt:3,throttleWait:300,events:D},z=k(f,e.throttleWait);function p(t,r){t._lazy.arg===B?t.style.backgroundImage="url("+r+")":t.setAttribute("src",r)}function Y(t){t._lazy.loading&&p(t,t._lazy.loading),f()}function Z(t){t._lazy.error&&p(t,t._lazy.error),t._lazy.state="error",E(t),f()}function x(t,r){p(t,r),t._lazy.state="success",E(t),f()}function j(t){var r;d.includes(t)||(d.push(t),(r=e.events)==null||r.forEach(a=>{t.addEventListener(a,z,{passive:!0})}))}function K(){d.forEach(t=>{var r;(r=e.events)==null||r.forEach(a=>{t.removeEventListener(a,z)})}),d.length=0}function V(t,r){var a,n,i={loading:(a=t.getAttribute(M))!=null?a:e.loading,error:(n=t.getAttribute(S))!=null?n:e.error,attempt:t.getAttribute(O)?Number(t.getAttribute(O)):e.attempt};t._lazy=A({src:r.value,arg:r.arg,currentAttempt:0,state:"pending",attemptLock:!1},i),p(t,y),W(e.filter,t._lazy)}function H(t,r){var a=new Image;a.src=r,t._lazy.preloadImage=a,a.addEventListener("load",()=>{t._lazy.attemptLock=!1,w.add(r),x(t,r)}),a.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?Z(t):I(t)})}function I(t){if(!t._lazy.attemptLock){t._lazy.attemptLock=!0,t._lazy.currentAttempt++;var{src:r}=t._lazy;if(w.has(r)){x(t,r),t._lazy.attemptLock=!1;return}Y(t),H(t,r)}}function L(t){return g.apply(this,arguments)}function g(){return g=m(function*(t){yield C(),N(t)&&I(t)}),g.apply(this,arguments)}function f(){c.forEach(t=>L(t))}function J(t){return v.apply(this,arguments)}function v(){return v=m(function*(t){!c.includes(t)&&c.push(t),T(t).forEach(j),yield L(t)}),v.apply(this,arguments)}function E(t){G(c,t),c.length===0&&K()}function Q(t,r){var{src:a,arg:n}=t._lazy;return a!==r.value||n!==r.arg}function P(t,r){return h.apply(this,arguments)}function h(){return h=m(function*(t,r){V(t,r),yield J(t)}),h.apply(this,arguments)}function U(t,r){return _.apply(this,arguments)}function _(){return _=m(function*(t,r){if(!Q(t,r)){c.includes(t)&&(yield L(t));return}yield P(t,r)}),_.apply(this,arguments)}function X(t){t===void 0&&(t={});var{events:r,loading:a,error:n,attempt:i,throttleWait:o,filter:u}=t;e.events=r!=null?r:e.events,e.loading=a!=null?a:e.loading,e.error=n!=null?n:e.error,e.attempt=i!=null?i:e.attempt,e.throttleWait=o!=null?o:e.throttleWait,e.filter=u}var q={mounted:P,unmounted:E,updated:U,install(t,r){X(r),z=k(f,e.throttleWait),t.directive("lazy",this)}};const rt=q;export{rt as L};
